<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Editor</title>
  <style>
    html,body{
      margin:0;
      padding:0;
      background:#111;
      height:100%;
      width:100%;
      overflow:hidden;
    }

    iframe{
      border:none;
      border-radius:10px;
      background:transparent;
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      transition:opacity .8s ease;
    }

    /* main preview fills top 75% */
    #frame3{
      width:90%;
      top:3%;
      height:75vh;
      opacity:0;
      z-index:1;
      pointer-events:none;
    }

    /* add-layer button */
    #frame4{
      width:200px;
      height:60px;
      bottom:110px;
      z-index:3;
      opacity:0;
    }

    /* anchor button */
    #frame5{
      width:180px;
      height:60px;
      bottom:50px;
      z-index:4;
      opacity:1;
    }

    /* bottom control buttons */
    #run,#clear,#clearAll,#move,#light,#save{
      width:70px;
      height:40px;
      bottom:5px;
      opacity:0;
      pointer-events:none;
      z-index:5;
    }

    #run{left:calc(50% - 210px);}
    #clear{left:calc(50% - 135px);}
    #clearAll{left:calc(50% - 60px);}
    #move{left:calc(50% + 15px);}
    #light{left:calc(50% + 90px);}
    #save{left:calc(50% + 165px);}
  </style>
</head>
<body>
  <iframe id="frame3"></iframe>
  <iframe id="frame4"></iframe>
  <iframe id="frame5"></iframe>
  <iframe id="run"></iframe>
  <iframe id="clear"></iframe>
  <iframe id="clearAll"></iframe>
  <iframe id="move"></iframe>
  <iframe id="light"></iframe>
  <iframe id="save"></iframe>

  <script>
    const v=Date.now();
    const frame3=document.getElementById('frame3');
    const frame4=document.getElementById('frame4');
    const frame5=document.getElementById('frame5');
    const buttons=['run','clear','clearAll','move','light','save'].map(id=>document.getElementById(id));

    frame3.src=`preview.html?v=${v}`;
    frame4.src=`add-layer.html?v=${v}`;
    frame5.src=`ancr.html?v=${v}`;
    document.getElementById('run').src=`run.html?v=${v}`;
    document.getElementById('clear').src=`clear.html?v=${v}`;
    document.getElementById('clearAll').src=`clear-all.html?v=${v}`;
    document.getElementById('move').src=`move.html?v=${v}`;
    document.getElementById('light').src=`light.html?v=${v}`;
    document.getElementById('save').src=`save.html?v=${v}`;

    window.addEventListener('message',e=>{
      const d=e.data;
      if(!d)return;
      if(d.type==='updatePreview'){
        frame3.contentWindow.postMessage({type:'addLayer',code:d.code},'*');
        setTimeout(()=>{frame3.style.opacity='1';},800);
        setTimeout(()=>{
          frame4.style.opacity='1';
          buttons.forEach(b=>{
            b.style.opacity='1';
            b.style.pointerEvents='auto';
          });
        },1600);
      }
    });
  </script>
</body>
</html>
