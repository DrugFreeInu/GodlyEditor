<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Editor</title>
<style>
html,body{
  margin:0;
  background:#111;
  height:100%;
  width:100%;
  overflow:hidden;
  position:fixed;
  top:0;left:0;
  font-family:monospace;
}
iframe{
  border:none;
  border-radius:10px;
  background:transparent;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  transition:opacity .8s ease;
}

/* poem centered */
#frame1{
  width:90%;height:15%;
  top:35%;
  z-index:3;
  pointer-events:none;
  opacity:1;
  transition:opacity 1s ease;
}

/* layer box */
#frame2{
  width:340px;
  height:200px;
  position:fixed;
  top: calc(100% - 140px);
  left:calc(50% - 30px);
  z-index:2;
  pointer-events:auto;
  opacity:1;
  transition:opacity 1s ease, box-shadow .3s ease, border .3s ease;
  border-radius:10px;
  background:transparent;
  border:2px solid transparent;
}
#frame2.active {
  border:2px solid #ffcc00;
  box-shadow:0 0 20px #ffcc00aa;
}

/* preview */
#frame3 {
  width: 60%;
  height: 55vh;
  top: 8%;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 12px;
  z-index: 1;
  opacity: 0;
  pointer-events: none;
}

/* notepad */
#frame7{
  width:340px;
  height:320px;
  bottom:10px;
  right:10px;
  position:fixed;
  border-radius:12px;
  z-index:5;
  opacity:0;
  pointer-events:none;
  transition:opacity .3s ease,transform .2s ease;
  cursor:grab;
}

/* button layout */
#run{bottom:160px;left:calc(50% - 160px);}
#clear{bottom:160px;left:calc(50% - 80px);}
#clearAll{bottom:160px;left:calc(50%);}
#move{bottom:160px;left:calc(50% + 80px);}
#save{bottom:160px;left:calc(50% + 160px);}
#light{bottom:120px;left:calc(50% - 80px);}
#anchor{bottom:120px;left:calc(50%);}

#run,#clear,#clearAll,#move,#light,#save,#anchor,#add{
  width:65px;
  height:35px;
  opacity:0;
  pointer-events:none;
  z-index:6;
  transition:opacity .5s ease, box-shadow .15s ease, border .15s ease;
  border:2px solid transparent;
  border-radius:8px;
}

/* selected button state */
.selected {
  border:2px solid #ffcc00 !important;
  box-shadow:0 0 15px #ffcc00aa;
}

/* arrow row */
.arrow{
  width:55px;
  height:35px;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  justify-content:center;
  background:#00ffcc;
  color:#000;
  font-size:1.2rem;
  font-weight:bold;
  border-radius:8px;
  box-shadow:0 0 10px rgba(0,255,204,.4);
  opacity:0;
  pointer-events:none;
  transition:opacity .5s ease, box-shadow .15s ease, border .15s ease;
  z-index:6;
  border:2px solid transparent;
}
#up{bottom:70px;left:calc(50% - 105px);}
#left{bottom:70px;left:calc(50% - 35px);}
#down{bottom:70px;left:calc(50% + 35px);}
#right{bottom:70px;left:calc(50% + 105px);}

/* toggle notepad button */
#toggleNotepad{
  position:fixed;
  bottom:15px;
  left:15px;
  z-index:10;
  font-family:monospace;
  font-size:1rem;
  letter-spacing:1px;
  text-transform:uppercase;
  color:#000;
  background:#00ffcc;
  border:none;
  padding:10px 25px;
  border-radius:8px;
  cursor:pointer;
  transition:all .3s ease;
  box-shadow:0 0 10px rgba(0,255,204,.3);
}
#toggleNotepad:hover{
  background:#00ddb0;
  box-shadow:0 0 20px rgba(0,255,204,.6);
  transform:scale(1.05);
}
#toggleNotepad:active{
  transform:scale(.96);
  box-shadow:0 0 25px rgba(0,255,204,.9);
}
</style>
</head>
<body>
<iframe id="frame1"></iframe>
<iframe id="frame2"></iframe>
<iframe id="frame3"></iframe>
<iframe id="frame6"></iframe>
<iframe id="frame7"></iframe>

<iframe id="run"></iframe>
<iframe id="clear"></iframe>
<iframe id="clearAll"></iframe>
<iframe id="move"></iframe>
<iframe id="light"></iframe>
<iframe id="save"></iframe>
<iframe id="anchor"></iframe>
<iframe id="add"></iframe>

<div id="up" class="arrow">↑</div>
<div id="left" class="arrow">←</div>
<div id="down" class="arrow">↓</div>
<div id="right" class="arrow">→</div>

<button id="toggleNotepad">NOTEPAD</button>

<script>
const v=Date.now();
const frame1=document.getElementById('frame1');
const frame2=document.getElementById('frame2');
const frame3=document.getElementById('frame3');
const frame7=document.getElementById('frame7');
const toggleBtn=document.getElementById('toggleNotepad');
const ids=['run','clear','clearAll','move','light','save','anchor','add','up','left','down','right'];
const buttons=ids.map(id=>document.getElementById(id));

// load iframes
frame1.src=`welcome.html?v=${v}`;
frame2.src=`layer1.html?v=${v}`;
frame3.src=`preview.html?v=${v}`;
frame7.src=`notepad.html?v=${v}`;
document.getElementById('run').src=`run.html?v=${v}`;
document.getElementById('clear').src=`clear.html?v=${v}`;
document.getElementById('clearAll').src=`clear-all.html?v=${v}`;
document.getElementById('move').src=`move.html?v=${v}`;
document.getElementById('light').src=`light.html?v=${v}`;
document.getElementById('save').src=`save.html?v=${v}`;
document.getElementById('anchor').src=`ancr.html?v=${v}`;
document.getElementById('add').src=`add-layer.html?v=${v}`;

// show buttons after paste
window.addEventListener('message',e=>{
  const d=e.data;if(!d)return;
  if(d.type==='pasteDetected'){
    buttons.forEach(b=>{
      b.style.opacity='1';
      b.style.pointerEvents='auto';
    });
  }
  if(d.type==='updatePreview'){
    frame1.style.opacity='0';
    setTimeout(()=>{frame1.style.display='none';},1000);
    frame3.contentWindow.postMessage({type:'addLayer',code:d.code},'*');
    setTimeout(()=>{frame3.style.opacity='1';},1200);
  }
});

// layer selection highlight
frame2.addEventListener('click',()=>{
  frame2.classList.toggle('active');
});

// quick visual select
function selectButton(el){
  buttons.forEach(b=>b.classList.remove('selected'));
  el.classList.add('selected');
}

// arrows movement
const moveMap = {
  up:{x:0,y:-10}, down:{x:0,y:10}, left:{x:-10,y:0}, right:{x:10,y:0}
};
['up','down','left','right'].forEach(dir=>{
  const btn=document.getElementById(dir);
  btn.addEventListener('click',()=>{
    if(!frame2.classList.contains('active')) return;
    selectButton(btn);
    frame3.contentWindow.postMessage({type:'moveShape',dir,offset:moveMap[dir]},'*');
  });
});

// main buttons instant select
buttons.forEach(b=>{
  if(b.classList.contains('arrow')) return;
  b.addEventListener('click',()=>selectButton(b));
});

// toggle notepad
toggleBtn.addEventListener('click',()=>{
  const open=frame7.style.opacity==='1';
  frame7.style.opacity=open?'0':'1';
  frame7.style.pointerEvents=open?'none':'auto';
  toggleBtn.textContent=open?'NOTEPAD':'CLOSE';
});

// drag notepad
let drag=false,offX=0,offY=0;
frame7.addEventListener('mousedown',e=>{
  drag=true;
  offX=e.clientX-frame7.getBoundingClientRect().left;
  offY=e.clientY-frame7.getBoundingClientRect().top;
  frame7.style.cursor='grabbing';
});
document.addEventListener('mousemove',e=>{
  if(!drag)return;
  let x=e.clientX-offX;
  let y=e.clientY-offY;
  x=Math.max(0,Math.min(window.innerWidth-frame7.offsetWidth,x));
  y=Math.max(0,Math.min(window.innerHeight-frame7.offsetHeight,y));
  frame7.style.left=x+'px';
  frame7.style.top=y+'px';
  frame7.style.transform='none';
});
document.addEventListener('mouseup',()=>{
  if(drag){drag=false;frame7.style.cursor='grab';}
});
</script>
</body>
</html>
