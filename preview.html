<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style>
  body {
    margin: 0;
    background: #222;
    overflow: hidden;
    position: relative;
  }
  .layer {
    position: absolute;
    top: 50px;
    left: 50px;
    width: 80%;
    height: 80%;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: white;
  }
</style>
</head>
<body>
<script>
  function wrapIfNeeded(code) {
    const trimmed = code.trim();

    // Already valid HTML doc
    if (trimmed.startsWith("<!DOCTYPE") || trimmed.startsWith("<html")) {
      return code;
    }

    // Inject into a simple safe HTML shell
    return `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>body{white-space:pre; font-family:monospace; padding:20px;}</style>
</head>
<body>
${code.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
</body>
</html>`;
  }
<script>
window.addEventListener('message', e => {
  const d = e.data;
  if (!d || d.type !== 'updatePreview') return;

  let el = document.getElementById('layer' + d.layer);
  if (!el) {
    el = document.createElement('div');
    el.id = 'layer' + d.layer;
    el.className = 'layer';
    document.body.appendChild(el);
  }

  el.innerHTML = '';

  const iframe = document.createElement('iframe');
  iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts');
  iframe.srcdoc = d.code;

  el.appendChild(iframe);
});
</script>
</body>
</html>
