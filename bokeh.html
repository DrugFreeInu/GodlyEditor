<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>BOKEH Â· GODLY EDITOR</title>

<style>
:root {
  --pink: #ff6b9d;
  --bg: #000;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: var(--pink);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  text-align: center;
}

/* Canvas area */
#bokehCanvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  z-index: 1;
}

/* Control panel */
.controls {
  position: fixed;
  bottom: 20px;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(0,0,0,0.4);
  padding: 10px 20px;
  border-radius: 12px;
  border: 2px solid var(--pink);
  backdrop-filter: blur(10px);
}

.controls input[type="file"] {
  color: var(--pink);
  margin-bottom: 10px;
}

.slider {
  width: 200px;
  margin: 4px 0;
}
label {
  font-size: 13px;
  letter-spacing: 1px;
}
</style>
</head>
<body>
<canvas id="bokehCanvas"></canvas>

<div class="controls">
  <input type="file" id="imageUpload" accept="image/*">
  <label>Intensity <input type="range" id="intensity" min="10" max="300" value="120" class="slider"></label>
  <label>Size <input type="range" id="size" min="5" max="100" value="40" class="slider"></label>
  <label>Speed <input type="range" id="speed" min="0.1" max="5" step="0.1" value="1.2" class="slider"></label>
</div>

<script>
const canvas = document.getElementById('bokehCanvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

let particles = [];
let imgData = null;

document.getElementById('imageUpload').addEventListener('change', handleImage);

function handleImage(e) {
  const file = e.target.files[0];
  if (!file) return;
  const img = new Image();
  img.onload = () => {
    const off = document.createElement('canvas');
    const offCtx = off.getContext('2d');
    off.width = img.width;
    off.height = img.height;
    offCtx.drawImage(img, 0, 0);
    imgData = offCtx.getImageData(0, 0, img.width, img.height);
    createParticles();
  };
  img.src = URL.createObjectURL(file);
}

function createParticles() {
  particles = [];
  if (!imgData) return;
  const step = 4;
  for (let y = 0; y < imgData.height; y += step) {
    for (let x = 0; x < imgData.width; x += step) {
      const i = (y * imgData.width + x) * 4;
      const r = imgData.data[i], g = imgData.data[i+1], b = imgData.data[i+2];
      const brightness = (r + g + b) / 3;
      if (brightness > 100) {
        particles.push({
          x: Math.random() * W,
          y: Math.random() * H,
          radius: Math.random() * 20,
          color: `rgba(${r},${g},${b},0.25)`,
          dx: (Math.random() - 0.5) * 0.5,
          dy: (Math.random() - 0.5) * 0.5
        });
      }
    }
  }
}

function animate() {
  const intensity = document.getElementById('intensity').value;
  const size = document.getElementById('size').value;
  const speed = document.getElementById('speed').value;

  ctx.clearRect(0, 0, W, H);
  for (let p of particles) {
    ctx.beginPath();
    const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius * (size/50));
    grad.addColorStop(0, p.color);
    grad.addColorStop(1, 'transparent');
    ctx.fillStyle = grad;
    ctx.arc(p.x, p.y, p.radius * (size/50), 0, Math.PI * 2);
    ctx.fill();

    p.x += p.dx * speed;
    p.y += p.dy * speed;
    if (p.x < 0) p.x = W;
    if (p.y < 0) p.y = H;
    if (p.x > W) p.x = 0;
    if (p.y > H) p.y = 0;
  }
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
